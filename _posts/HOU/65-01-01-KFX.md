---
title: KFX

categories:
 - HOU
tags:
- Houdini
- Animation
- SOP
description: KineFX - Rigs, Retarget, Animation
permalink: /kfx/
---








# [Kine FX](https://www.sidefx.com/docs/houdini/character/kinefx/index.html)   


All working on world level on points. The parent-child relationship between joints in a hierarchy is determined by vertex order. However, point ordering is not considered when traversing the hierarchy.
Create skeleton. Rig is separated (like shadow rig) hierarchy to control rig > clean for export   

[CFX](/cfx/), [Unreal Animation](/uanim/), [Principles of animation](/animation/)   
[SOP_KineFX.hiplc](/src/hip/SOP_KineFx.hiplc)  

## Nomenclature

- **Joint** - point that is part of hierarchy. In world space
 - `@name` unique per point   
 - `@P`  (3flt)    - handle world space translation
 - `@transform` (9flt - matrix) - (matrix3) translation, rotation, scale
 - `rest transform` - can add 4x4
- **Hierarchy** - poly line - define hierarchy of joints
- **Control Geo** - (name on primitive)  



# Create skeleton

<img src="/src/kine/c1.png" width="350">     



## Create Skeleton From points
- [ **Add** ] SOP.  to merg points to poly lines
- [ **Reparent Joints** ] SOP. To create continous hierarchy. (select joint, and parent)

To create a spline

## Create Skeleton From spline

Skeleton from `Poly line` or `L-system` with [Rig Doctor] SOP node (and later with Skeleton SOP )


#### [Rig doctor] SOP
- create missing `@name`  
- debug hierarchy
- check [x] initialize Transforms


## Create Skeleton Draw
#### [Skeleton] SOP
Modify and Create ~skelet. Can control bone placement, rename bones, orient selected bones, a lot of shortcuts (`RMB` menu, `P` - details of joints).
- create `@localtransform`.  (with correct orientation)


Start from root to end.  in create mode.....

Workflow:
create spine:
- from side view create 1 bone in center of gravity (COG)> to bottom of neck, (spine_end)
- select joint RMB > split  
 - child compensate on bar > fix pos
- select all RMB > orient selected joints
- select first (COG) > P > zero rotate value
- name
create leg
- from side view
- new chain MMB
- from hip  to foot
- from front view fix start and rotete
create head:
- enter to create mode
- from side view (no child compensate), connected to end spine
create hands:
create clavicle:
- as a point.
reparent to connect:
mirror:






----------
#### [Skeleton Mirror] SOP


#### [Delete Joints] SOP
 - with reparent  

#### [Orient along curve] SOP

- create transform (3x3 transform), and tangent metod to next edge  



#### [Re-Orient Joints] SOP
Orientation mater only for hand drawn houdini rigs
To fix orientation. Re-orient joints with direction picking.
[sidefx.com/docs/houdini/character/kinefx/skeletons.html](https://www.sidefx.com/docs/houdini/character/kinefx/skeletons.html#creatingskels)


### configure skeleton

configure joints: - limits shown as orange rect  
`Shift` + `7 (or8)` to configure limit.  
`Shift` + `F` to flip handle   

# Retarget

<img src="/src/kine/d1.png" width="350">    

Retarget   
1. [ **Rig Match Pose** ] SOP -   lineup pose in viewport  (Align target skeleton 2op is master )  
2. [ **Map Points** ] SOP - 2 . match points

Crack IK transfers & rotates:    
3. [ **Full Body IK** ]  SOP -  final retargeting    
4. [ **FK Transfer** ] SOP -  
5. [ **Skeleton Blend** ] SOP - i.e. fullbodyik/fktransfer

# Motion

### Root motion
- [ **Extract Locomotion** ] SOP -  extract root motion   



```
#### Mix Skeletons ? // Anims
- [ **Skeleton Blend** ] SOP - feed with 2 animations
- [ **Time Shift** ] SOP
```



## Motion Clips
[ **Motion Clip** ] SOP. Not time dependent (see all frames at once). One packed primitive per frame with `@time` attrribute. To operate on neighbour frames.     
[ **Motion Clip Evaluate** ] SOP -  Time dependent Animation - One pose per frame.  

- [ **Configure Clip Info** ] SOP  
- [ **Motion Clip Cycle** ] SOP
- [ **Motion Clip Extract** ] SOP  - Extract Frames
- [ **Motion clip retime** ] SOP  --


### Mix Animations

- **[ Motion Clip Blend] SOP**  - kitbash 2 files. 1 as base second for mix. Can delete some bones and apply partial animation.



# Motion Sources

## Key Animation
`rigpose` - initial frame or per frame anim


## Mocap
- `motion clip extract key poses` - optimize mocap




## Secondary motion
- `rig statch pose` with `rest_transform` can be used later
-  motion clip  or > secondary motion to convert to clips
  - source joint group as root and
-  evaluate
- `secondary motion` - jiggle / spring / lag/overshoot



## Ragdoll
is on bullet and scale must be accurate

`Ragdoll Collision Shape`   
- setup spheres
-
in construction of colliision shape can use custom but `name` is required, and collision should be packed

`Ragdoll constraints`
if no group will take closest ??

- internal constaint
- 2 op: for external constraint joint to geo group  (glue, hard (pin and stuck), soft)

### Ragdoll Solver



## Vellum


`rigstashpose` - create rest pos 4x4Matrix Store a static pose on a skeleton as a matrix point attribute.





# Controls
Build the animation rig.


- `configure joints`  - not only for limits. (can have multiple nodes chained)
- `full body ik` - most complex - local center of mass, ... rotation weights/limits
but albo other attrib like for
- `Ragdoll`  - only rotation limits  
- `Rig Pose`  - rotation trans limits

Rotation order !!!! components:  1  is lookat , 2 is (twist), 3 axis

### IK


- [ **IK Chain** ] SOP. op1: skeleton. op2 control points with same name  (reparent sop with *)
   - select  root mid and tip bones points
   - set! match by name
- manipulate pose before 2 op of ik chain

<img src="/src/kine/ik1.png" width="150">   

### Full body IK
to 2op:
- create controllers by deleting parts of skeleton
- [Deleet joints]
- [reparent] with *
- rig pose

[Fullbody IK]
- match by attribute ! (name)
- can pin root
- can comupte weigth
### Curve
<img src="/src/kine/curve.png" width="150">    




### Control geometry
`Control`(or any geo) +  prim name     
`AtachControlGeo` -

- `attach joint geo` (as 3op of pose tool) still technical approach. (next release for artists approach)


- motion trails (animation style) in SOP
---

# Capture (skin)
Skin geometry.


## Capture soft

<img src="/src/kine/skin.png" width="350">   


Capture workflow nodes:   
- `BoneCaptureLine` - define capture regions @joints    
- `Tetembed`, create mesh weightings  
- `BoneCaptureBiharmonic`, transfers weights to skin   

change pose and `Capturelayerpaint` to paint  after biharmonic (po region name wiec troche odporne )


## Capture rigid

`capturePackedGeo` - check pack input>unpack Output . manual capture: geo: * joint name of joint


---


# Rig Wrangle

`rotate(3@localtransform, @Time, {1,0,0});`


# Rig VOP

twoboneik
lookatconstraint
parentconstraint


### VOP:
`rigattribvop` - chops and more stuff

#### VOPS
`lookatkinefx` -  
`lookat constraint` -  


---

# Repair
`realistic shoulder` -        
`reverse foot` -   
`stabilize joints` -   select joints to stabilize,

---


# To Unreal

90+- ?  how to position anim and where is save to rotate ?????

control rig - manipulating bones transforms   
animation graf - blending , playback  




---


[cgwiki](https://www.tokeru.com/cgwiki/index.php?title=HoudiniKinefx)   
[V Ron Andic channel](https://vimeo.com/rokandic)
[YT KineFX A Simple IK/FK](https://www.youtube.com/watch?v=zMcLms5a0lo)   
[KineFX Masterclass | Houdini Illume | Jeff Wagner](https://www.youtube.com/watch?v=Z04t_OxBshA)  
[Henry HIVE](https://www.youtube.com/watch?v=iME3rfsRFP0)      
[Houdini KineFX 101: Tutorial One - FBX Import, Rig Pose, Skeleton Blend](https://www.youtube.com/watch?v=7vg0bnc5R7Y)   

-----------
crowd  
Agent from skeleton
